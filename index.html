<!doctype html>
<html lang="zh-Hant">
<head>
  <!-- âœ… ç¤¾ç¾¤åˆ†äº«ç¸®åœ–ï¼ˆOGï¼‰ -->
  <meta property="og:title" content="ä»Šæ—¥æŒ‡å¼•ï½œå–µå–µæ•™ä¸»">
  <meta property="og:description" content="ä»Šå¤©ä¹Ÿæ˜¯ç¾å¥½çš„ä¸€å¤©">
  <meta property="og:image" content="https://meowmeowjiaojhu.github.io/today/icons/meowOG.png">
  <meta property="og:url" content="https://meowmeowjiaojhu.github.io/today/">
  <meta property="og:type" content="website">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ä»Šæ—¥æŒ‡å¼•</title>

  <!-- âœ… PWA -->
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#120a2a">

  <!-- favicon -->
  <link rel="icon" type="image/png" sizes="512x512" href="icons/meowlogo512.png">
  <link rel="apple-touch-icon" href="icons/meowlogo192.png">

  <!-- GA -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BSEZT46Z9V"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BSEZT46Z9V');
  </script>

  <style>
    :root{
      --text:#111;
      --muted:#666;
      --shadow: 0 18px 50px rgba(0,0,0,0.12);
      --radius: 22px;
      --bg1:
        radial-gradient(1100px 700px at 15% 8%,  rgba(255,210,230,0.85), transparent 58%),
        radial-gradient(1000px 650px at 85% 12%, rgba(255,238,190,0.85), transparent 60%),
        radial-gradient(1100px 750px at 20% 92%, rgba(200,230,255,0.82), transparent 62%),
        radial-gradient(900px 650px at 88% 88%,  rgba(215,255,230,0.78), transparent 64%),
        radial-gradient(1000px 700px at 70% 35%, rgba(235,215,255,0.78), transparent 62%),
        linear-gradient(180deg, #fffaf4 0%, #ffffff 55%, #f7f9fb 100%);
    }
    *{ box-sizing: border-box; }

    /* ğŸŒˆ èƒŒæ™¯ */
    body{
      font-family: system-ui, -apple-system, "PingFang TC", "Noto Sans TC", sans-serif;
      margin: 0;
      min-height: 100vh;
      background: var(--bg1);
      background-attachment: fixed;

      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 16px;
    }

    main{ width:100%; max-width:520px; }

    h1{
      font-size:26px;
      margin:0 0 18px;
      text-align:center;
      letter-spacing:.06em;
      opacity:.95;
    }

    /* ğŸ«§ å¡ç‰‡ */
    .card{
      position: relative;
      border-radius: var(--radius);
      padding: 26px 24px 28px;
      box-shadow: var(--shadow);
      background: rgba(255,255,255,0.60);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow: hidden;
    }

    /* ğŸ± Logoï¼šå¯æ„›åœ“å¼§ã€ç„¡ç™½æ¡† */
    .card-image{
      width: 108px;
      height: 108px;
      border-radius: 26px;   /* åœ“è§’æ–¹å½¢ */
      object-fit: cover;
      background: transparent;
      padding: 0;
      display: block;
      margin: 0 auto 18px;
      box-shadow: 0 12px 26px rgba(0,0,0,0.14);
    }

    /* âœ¨ é‡‘æ¡† */
    .card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius: var(--radius);
      padding:1.6px;
      background: linear-gradient(
        135deg,
        rgba(255,219,160,.95),
        rgba(255,244,210,.7),
        rgba(255,219,160,.95)
      );
      -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events:none;
    }

    .card::after{
      content:"";
      position:absolute;
      inset:-22px;
      border-radius: calc(var(--radius) + 20px);
      background:
        radial-gradient(420px 220px at 20% 10%, rgba(255,220,170,0.25), transparent 60%),
        radial-gradient(380px 200px at 80% 30%, rgba(255,235,195,0.20), transparent 62%);
      filter: blur(8px);
      pointer-events:none;
      opacity:.9;
    }

    /* ğŸ’¬ æ–‡å­—ï¼ˆç¶²ç«™ç‰ˆï¼šèˆ’æœé–±è®€ï¼‰ */
    .msg{
      font-size:20px;
      line-height:1.85;
      white-space:pre-line;
      margin:0;
      padding:22px 20px;
      border-radius:18px;

      background:
        radial-gradient(520px 260px at 20% 0%, rgba(255,214,224,.40), transparent 60%),
        radial-gradient(520px 260px at 80% 10%, rgba(209,234,255,.35), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.90));

      color:#4f4d66;
      text-align:center;
      overflow-wrap:anywhere;
      word-break: break-word;
    }

    button{ font:inherit; cursor:pointer; border:none; }

    .ghost, .share-btn{
      display:block;
      margin:14px auto 0;
      padding:10px 22px;
      border-radius:999px;
      font-weight:900;
      background: rgba(255,255,255,0.92);
      border:1px solid rgba(17,17,17,0.22);
      box-shadow:0 8px 20px rgba(0,0,0,0.08);
    }

    .primary{
      display:block;
      margin-top:16px;
      padding:14px;
      text-align:center;
      border-radius:14px;
      text-decoration:none;
      font-weight:900;
      letter-spacing:.02em;

      background: linear-gradient(
        135deg,
        #6b5cff,
        #9b7cff,
        #f5c97b,
        #f0b94d
      );
      color:#2a1a00;
      box-shadow:0 10px 28px rgba(107,92,255,.22);
    }

    .hint{
      margin-top:16px;
      font-size:13px;
      color:rgba(70,70,90,.8);
      text-align:center;
      letter-spacing:.06em;
      opacity:.9;
    }

    @media (max-width:420px){
      h1{ font-size:25px; }
      .msg{ font-size:19px; }
    }

    /* âœ… å­˜åœ–ï¼šéš±è— */
    .hide-for-capture{ display:none!important; }

    /* ===============================
       ğŸ“¸ 4Ã—5 å­˜åœ–å°ˆç”¨ç•«å¸ƒï¼ˆé—œéµï¼‰
       - 1080Ã—1350
       - èƒŒæ™¯è·Ÿç¶²ç«™ä¸€è‡´
       - ä¸ç”¨ blurï¼ˆé¿å…ç°éœ§ï¼‰
       =============================== */
    .capture-area.capture-mode{
      width: 1080px;
      height: 1350px;
      padding: 120px 90px;
      border-radius: 48px;

      display:flex;
      align-items:center;
      justify-content:center;

      background:
        radial-gradient(900px 600px at 15% 8%,  rgba(255,210,230,0.55), transparent 60%),
        radial-gradient(900px 600px at 85% 12%, rgba(255,238,190,0.55), transparent 62%),
        radial-gradient(900px 650px at 20% 92%, rgba(200,230,255,0.50), transparent 64%),
        radial-gradient(800px 600px at 88% 88%,  rgba(215,255,230,0.48), transparent 66%),
        radial-gradient(900px 650px at 70% 35%, rgba(235,215,255,0.50), transparent 64%),
        linear-gradient(180deg, #fffaf4 0%, #ffffff 100%);
    }

    /* å­˜åœ–æ™‚ï¼šå¡ç‰‡è®Šä¹¾æ·¨ï¼Œä¸éœ§ï¼›ä½†é‡‘æ¡†ä¿ç•™ */
    .capture-area.capture-mode .card{
      width: 100%;
      max-width: 860px;
      padding: 56px 54px 52px;

      background: rgba(255,255,255,0.92);
      backdrop-filter:none;
      -webkit-backdrop-filter:none;

      box-shadow: 0 30px 70px rgba(0,0,0,0.18);
    }

    /* å­˜åœ–æ™‚ï¼šlogo å¤§ä¸€é»ã€ä»ç„¶åœ“å¼§ç„¡ç™½æ¡† */
    .capture-area.capture-mode .card-image{
      width: 140px;
      height: 140px;
      border-radius: 34px;
      margin: 0 auto 26px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.16);
    }

    /* å­˜åœ–æ™‚ï¼šæ–‡å­—ä¸æœƒå¤ªå¤§ã€ä¹Ÿä¸å®¹æ˜“é†œæ–·è¡Œ */
    .capture-area.capture-mode .msg{
      font-size: 24px;
      line-height: 1.95;
      padding: 28px 26px;
      border-radius: 22px;
      color: #3f3d55;

      /* è®“é•·å¥æ›´å„ªé›…ï¼šå„ªå…ˆé  CSS æ§åˆ¶ï¼Œä¸ç¡¬æ‹† */
      letter-spacing: .02em;
    }

    .capture-area.capture-mode .hint{
      margin-top: 22px;
      font-size: 14px;
      opacity: .78;
    }
  </style>
</head>

<body>
  <main>
    <h1>ä»Šæ—¥æŒ‡å¼•</h1>

    <!-- âœ… 4Ã—5 å­˜åœ–ç”¨ç•«å¸ƒï¼šå­˜åœ–åªæ‹é€™ä¸€å±¤ -->
    <section id="captureArea" class="capture-area">
      <section class="card" id="card-result" aria-label="ä»Šæ—¥æŒ‡å¼•å¡ç‰‡">
        <img src="icons/meowlogo512.png" alt="å–µå–µæ•™ä¸»" class="card-image">
        <p id="msg" class="msg">è¼‰å…¥ä¸­â€¦</p>

        <button class="ghost capture-hide" type="button" onclick="pickOne()">å†æŠ½ä¸€å¼µ</button>
        <a class="primary capture-hide" href="https://meowmeowjiaojhu.github.io/links/" target="_blank" rel="noopener">ä¾†æ‰¾å–µå–µ</a>
        <button id="btnSave" class="capture-hide share-btn" type="button">ğŸ“¸ å­˜æˆåˆ†äº«åœ–ï¼ˆ4Ã—5ï¼‰</button>

        <div class="hint"><span>æ„Ÿå—å…±æ™‚çš„ç¾å¥½</span></div>
      </section>
    </section>
  </main>

  <!-- html2canvas -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    function pickOne(){
      const el = document.getElementById("msg");
      const lines = window.LINES || ["ï¼ˆå¥å­åº«å°šæœªè¼‰å…¥ï¼‰"];
      const i = Math.floor(Math.random() * lines.length);
      el.textContent = lines[i];
    }

    // âœ… æ°¸é æŠ“åˆ°æœ€æ–° lines.jsï¼ˆç ´å¿«å–ï¼‰
    (function loadLines(){
      const s = document.createElement("script");
      s.src = `./lines.js?v=${Date.now()}`;
      s.onload = () => pickOne();
      s.onerror = () => {
        document.getElementById("msg").textContent = "ï¼ˆå¥å­åº«è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡é–‹æˆ–ç¨å¾Œå†è©¦ï¼‰";
      };
      document.head.appendChild(s);
    })();

    // âœ… å­˜åœ–ï¼ˆ4Ã—5ï¼‰
    async function saveAsImage(){
      const area = document.getElementById("captureArea");
      const btn = document.getElementById("btnSave");

      if (typeof html2canvas !== "function") {
        alert("å­˜åœ–å·¥å…·å°šæœªè¼‰å…¥ï¼Œç¨ç­‰ä¸€ä¸‹å†æŒ‰ä¸€æ¬¡ï½");
        return;
      }

      btn.disabled = true;

      // é€²å…¥å­˜åœ–æ¨¡å¼
      area.classList.add("capture-mode");
      document.querySelectorAll(".capture-hide")
        .forEach(el => el.classList.add("hide-for-capture"));

      // ç­‰é‡æ’ï¼ˆé¿å…æŠ“åˆ°åŠå¥—æ¨£å¼ï¼‰
      requestAnimationFrame(() => {
        html2canvas(area, {
          backgroundColor: null,  // ç”¨ capture-area è‡ªå·±çš„èƒŒæ™¯
          scale: 2,               // 1080Ã—1350 *2 = 2160Ã—2700
          useCORS: true
        }).then(canvas => {
          const link = document.createElement("a");
          link.download = "today-card-4x5.png";
          link.href = canvas.toDataURL("image/png");
          link.click();
        }).catch((e) => {
          console.error(e);
          alert("å­˜åœ–å¤±æ•—ï¼Œå¯èƒ½æ˜¯è³‡æºè¼‰å…¥æˆ–ç€è¦½å™¨é™åˆ¶ã€‚");
        }).finally(() => {
          // é‚„åŸ
          area.classList.remove("capture-mode");
          document.querySelectorAll(".capture-hide")
            .forEach(el => el.classList.remove("hide-for-capture"));
          btn.disabled = false;
        });
      });
    }

    // âœ… ç¶å®šæŒ‰éˆ•ï¼ˆé¿å… inline onclick çš„é›·ï¼‰
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("btnSave");
      if (btn) btn.addEventListener("click", saveAsImage);
    });

    // âœ… service worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js").then((reg) => {
        reg.update();
        navigator.serviceWorker.addEventListener("controllerchange", () => {
          window.location.reload();
        });
      });
    }
  </script>
</body>
</html>
